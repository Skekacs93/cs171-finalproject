<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title></title>

    <script src="libs/d3/d3.min.js" charset="utf-8"></script>
    <script src="http://d3js.org/queue.v1.min.js"></script>
    <script src="libs/jquery/jquery-2.1.1.min.js" charset="utf-8"></script>
    <script src="libs/bootstrap/js/bootstrap.min.js" charset="utf-8"></script>
    <script src="libs/topojson-js/topojson.min.js"></script>
    <script src="libs/datamaps.world.min.js"></script>

    <link rel="stylesheet" type="text/css" href="libs/bootstrap/css/bootstrap.min.css">
    <link href='http://fonts.googleapis.com/css?family=PT+Sans:400,700' rel='stylesheet' type='text/css'> 

    <!-- add own stylesheet-->
    <link rel="stylesheet" type="text/css" href="css/myStyle.css">

    <script src = "js/mapvis.js"></script>

</head>
<body>
    <div class="row" style="width: 96%;">
        <div id="title-row">
            <h1 class="title"> Analyzing Congressional Travel Data from 2007-Present <span class="authors"> by Steven Kekacs, Robert Doles, and Kunal Mehta </span> </h1>
            <h3 class="subtitle"> Can analyzing where congressmen travel give insights to what is important to them? </h3>
        </div>
    </div>
    <div class="row" id="body-row">
        <div class="col col-md-2">
            <div id="update-lists" class="body">
            A BUNCH OF LISTS BLAH BLAH BLAH
            </div>
        </div>
        <div class="col col-md-7">
            <div  id="mapVis" class="body">
            OUR GIANT WORLD MAP
            </div>
        </div>
        <div class="col col-md-3">
            <div id="filters" class="body">
            OUR FILTERS YAY FILTER STUFF
            </div>
        </div>
    </div>
    <div class="row" id="graphs-row">
        <div class="col col-md-12">
        A BUNCH OF SWEET GRAPHS AWESOME
        </div>
    </div>

    <script>
    $(function(){ // called after HTML is fully loaded
        var allData = []
        console.log("MAKING MAP!")
        var map = new Datamap({
            scope: 'world',
            element: document.getElementById('mapVis'),
            projection: 'orthographic',
            fills: {
              defaultFill: "#ABDDA4",
            },
            projectionConfig: {
              rotation: [97,-30]
            },
            data: {
              'USA': {fillKey: 'lt50' },
              'MEX': {fillKey: 'lt25' },
              'CAN': {fillKey: 'gt50' },     
              'GTM': {fillKey: 'gt500'},
              'HND': {fillKey: 'eq50' },
              'BLZ': {fillKey: 'pink' },
              'GRL': {fillKey: 'eq0' },
              'CAN': {fillKey: 'gt50' }       
            }
        });

        map.graticule();

        map.arc([{
            origin: {
                latitude: 61,
                longitude: -149
            },
            destination: {
                latitude: -22,
                longitude: -43
            }
            }], {
            greatArc: true,
            animationSpeed: 2000
        });


        var initVis = function(){
            MyEventHandler = new Object();

            map_vis = new MapVis(d3.select("#mapVis"), allData, MyEventHandler);

            $(MyEventHandler).bind("selectionChanged", function(event, type){map_vis.onSelectionChange(type);});

        }

        var dataLoaded = function(error, _allData){
            if(!error){
                allData = _allData.map(function(d){
                    return d
                })
                initVis();
            }
        }

        var startHere = function(){
            queue()
                .defer(d3.json, "data/travel.json")
                .await(dataLoaded)
        }
        startHere();

    })
    /**
     * Helper function that gets the width of a D3 element
     */
    var getInnerWidth = function(element) {
        var style = window.getComputedStyle(element.node(), null);

        return parseInt(style.getPropertyValue('width'));
    }
    </script>
</body>
</html>