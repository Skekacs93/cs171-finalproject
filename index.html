<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title></title>

    <script src="libs/d3/d3.min.js" charset="utf-8"></script>
    <script src="http://d3js.org/queue.v1.min.js"></script>
    <script src="libs/jquery/jquery-2.1.1.min.js" charset="utf-8"></script>
    <script src="libs/bootstrap/js/bootstrap.min.js" charset="utf-8"></script>
    <script src="http://d3js.org/topojson.v1.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/select2/4.0.0-rc.2/js/select2.min.js"></script>
    <script src="http://code.jquery.com/jquery-1.8.3.js"></script>
    <script src="http://code.jquery.com/ui/1.9.2/jquery-ui.js"></script>
    <script src="libs/topojson-js/topojson.min.js"></script>
    <script src="libs/datamaps.all.min.js"></script>


    <link rel="stylesheet" href="http://code.jquery.com/ui/1.9.2/themes/base/jquery-ui.css">
    <link rel="stylesheet" type="text/css" href="libs/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="css/chosen.min.css">
    <link rel="stylesheet" type="text/css" href="css/datepicker3.css">
    <link href='http://fonts.googleapis.com/css?family=PT+Sans:400,700' rel='stylesheet' type='text/css'>
    <link href="//cdnjs.cloudflare.com/ajax/libs/select2/4.0.0-rc.2/css/select2.min.css" rel="stylesheet" />  

    <!-- add own stylesheet-->
    <link rel="stylesheet" type="text/css" href="css/myStyle.css">

    <script src = "js/mapvis.js"></script>
    <script src = "js/chosen.jquery.min.js"></script>
    <script src = "js/bootstrap-datepicker.js"></script>

</head>
<body>
    <div class="row" style="width: 96%;">
        <div id="title-row">
            <h1 class="title"> Analyzing Congressional Travel Data from 2007-Present <span class="authors"> by Steven Kekacs, Robert Doles, and Kunal Mehta </span> </h1>
            <h3 class="subtitle"> Can analyzing where congressmen travel give insights to what is important to them? </h3>
        </div>
    </div>
    <div class="row" id="body-row">
        <div class="col col-md-2">
            <div id="update-lists" class="body">
            A BUNCH OF LISTS BLAH BLAH BLAH
            </div>
        </div>
        <div class="col col-md-8">
            <div  id="mapVis" class="body"></div>
        </div>
        <div class="col col-md-2">
            <div id="filters" class="body" onchange='console.log("HI");'>
                <div class="filters-header"> Select Visualization </div>
                <select style="margin-top: 10px; margin-bottom: 10px" class="select" id="viztype">
                    <option value="arcs">Arcs</option>
                    <option value="dots">Dots</option>
                </select>
                <div class="filters-header"> Filter Travel </div>
                <select data-placeholder="Select a Representative" id = "filter-member" class="select">
                </select>
                <select data-placeholder="Select a Destination Country" id = "filter-country" class="select">
                </select>
                <select data-placeholder="Select a Destination State" id = "filter-state" class="select">
                </select>
                <select data-placeholder="Select a Sponsor" id = "filter-sponsor" class="select">
                </select>
                <select data-placeholder="Filter by Party" id = "filter-party" class="select">
                    <option value=""></option>
                    <option value="R">Republican</option>
                    <option value="D">Democrat</option>
                </select>
                <select data-placeholder="Filter by Committee" id = "filter-committee" class="select">
                </select>
                <select data-placeholder="Filter by Ethnicity" id = "filter-ethnicity" class="select">
                </select>
                <select data-placeholder="Filter by Religion" id = "filter-religion" class="select">
                </select>
                <div class="input-daterange input-group" id="datepicker" style="margin-top: 10px; margin-bottom: 10px;">
                    <input id="startdate" type="text" class="input-sm form-control" name="start" />
                    <span class="input-group-addon">to</span>
                    <input id="enddate" type="text" class="input-sm form-control" name="end" />
                </div>
                <div class="filters-header"> Color Travel </div>
                <select data-placeholder="Color by Party" id = "color-by" class="select">
                    <option value="none"></option>
                    <option value="ethnicity">Ethnicity</option>
                    <option value="party">Party</option>
                    <option value="religion">Religion</option>
                </select>

            </div>
        </div>
    </div>
    <div class="row" id="graphs-row">
        <div class="col col-md-12">
        A BUNCH OF SWEET GRAPHS AWESOME
        </div>
    </div>

    <script>
    $(function(){ // called after HTML is fully loaded

        $(".select").change(function() { $(MyEventHandler).trigger("selectionChanged"); })
        var allData = []
        var metaData = []

        $('.input-daterange').datepicker({
            clearBtn: false,
        }).on("changeDate", function() {$(MyEventHandler).trigger("selectionChanged") })


        var initFilters = function() {
            d3.select("#filter-member")
                .selectAll("option")
                    .data(metaData["people"])
                .enter().append("option")
                    .text(function(d) { return d });
            d3.select("#filter-sponsor")
                .selectAll("option")
                    .data(metaData["sponsors"])
                .enter().append("option")
                    .text(function(d) { return d });
            d3.select("#filter-state")
                .selectAll("option")
                    .data(metaData["states"])
                .enter().append("option")
                    .text(function(d) { return d[1] })
                    .attr("value", function(d) { return d[0] });
            d3.select("#filter-country")
                .selectAll("option")
                    .data(metaData["countries"])
                .enter().append("option")
                    .text(function(d) { return d });
            d3.select("#filter-committee")
                .selectAll("option")
                    .data(metaData["committees"])
                .enter().append("option")
                    .text(function(d) { return d });
            d3.select("#filter-committee")
                .selectAll("option")
                    .data(metaData["committees"])
                .enter().append("option")
                    .text(function(d) { return d });
            d3.select("#filter-ethnicity")
                .selectAll("option")
                    .data(metaData["ethnicities"])
                .enter().append("option")
                    .text(function(d) { return d });
            d3.select("#filter-religion")
                .selectAll("option")
                    .data(metaData["religions"])
                .enter().append("option")
                    .text(function(d) { return d });

            $("#filter-member").chosen({allow_single_deselect: true});
            $("#filter-country").chosen({allow_single_deselect: true});
            $("#filter-state").chosen({allow_single_deselect: true});
            $("#filter-party").chosen({allow_single_deselect: true});
            $("#filter-committee").chosen({allow_single_deselect: true});
            $("#filter-ethnicity").chosen({allow_single_deselect: true});
            $("#filter-religion").chosen({allow_single_deselect: true});
            $("#filter-sponsor").chosen({allow_single_deselect: true});
            $("#color-by").chosen({allow_single_deselect: true});
            

        }

            

        var initVis = function(){
            MyEventHandler = new Object();

            map_vis = new MapVis(d3.select("#mapVis"), allData, metaData, MyEventHandler);

            $(MyEventHandler).bind("selectionChanged", function(event){map_vis.onSelectionChange();});

        }

        var dataLoaded = function(error, _allData, _metaData){
            if(!error){
                allData = _allData.map(function(d){
                    return d
                })
                metaData = _metaData
                initFilters();
                initVis();
            }
        }

        var startHere = function(){
            queue()
                .defer(d3.json, "data/travel.json")
                .defer(d3.json, "data/metadata.json")
                .await(dataLoaded)
        }
        startHere();

    })
    /**
     * Helper function that gets the width of a D3 element
     */
    var getInnerWidth = function(element) {
        var style = window.getComputedStyle(element.node(), null);

        return parseInt(style.getPropertyValue('width'));
    }
    </script>
</body>
</html>